# Phase 4: Six Degrees of Anywhere — Research & Design

---
**Last Updated**: February 28, 2026
**Status**: Research & prototyping — prompt validated, data gap identified
---

## Concept

Type two cities. See a chain of real tours connecting them through surprising thematic links — shared activities, cultural connections, overlapping cuisines, historical threads. The name "TourGraph" finally earns itself.

---

## Research Findings

### Existing "Six Degrees" Products

| Product | How connections work | Visualization | Key lesson |
|---------|---------------------|---------------|------------|
| Six Degrees of Wikipedia | BFS on pre-built hyperlink graph | Simple text chain | Two-input autocomplete pattern works |
| Oracle of Bacon | BFS on actor-movie bipartite graph | Text chain | **95% cache hit rate** — aggressive caching is essential |
| Six Degrees of Spotify | Neo4j graph DB, collaboration edges | **Vertical chain** with Spotify embeds | Vertical chain is simple and effective |
| Cinema Chain Game | Known graph, user guesses links | Vertical sequence | Step-by-step reveal creates excitement |
| The Six Degrees (app) | Daily word connection puzzle | Sequential reveal | "Daily" framing + surprising connections = engagement |
| Pathica | Neo4j on 2.2B Instagram edges | Chain display | Graph DBs for pre-existing edges, not needed for AI-generated chains |

**Key insight:** All existing products traverse a *pre-existing graph*. TourGraph is different — our connections are thematic and creative, generated by AI. That's the unique angle.

### Our Data: Thematic Coverage

From analysis of 9,800+ tours across 43 destinations:

| Theme | Tour count | Best cities |
|-------|-----------|-------------|
| Water (boats/cruises/sailing) | 708 | Everywhere |
| Food (cooking/tasting/culinary) | 540 | Ho Chi Minh City (31), Seoul (25), Singapore (22), Lima (21), Athens (20) |
| Drinks (wine/beer/brewing) | 178 | Wide spread |
| Photography | 170 | Wide spread |
| Sunset/Sunrise | 162 | Bali, Cape Town, Cancun |
| Hiking/Trekking | 130 | Bali, Cusco, Cape Town |
| Dark tourism (ghost/haunted) | 113 | San Antonio (13), Maryland (11), Key West (11), London (7) |
| Sacred (temples/churches/mosques) | 98 | Istanbul, Kyoto, Bali, Rome |
| Markets (bazaar/souk) | 81 | Marrakech, Istanbul, Seoul, Bangkok |
| Street art/graffiti | 17 | Buenos Aires, Barcelona, Amsterdam |

**8 cities with all themes covered** (natural chain hubs): Rome, Prague, Cape Town, Barcelona, Amsterdam, Ontario, Vienna, Sydney.

### Data Gap (Critical Discovery)

We only indexed **53 of 3,380 Viator destinations** — 1.6% of available data. This was a dev seed, not a production dataset. Missing entirely: Chicago, Miami, Berlin, Osaka, Hanoi, Dublin, Florence, Santorini, and thousands more.

**Impact on Six Degrees:** More cities = more surprising chains = better product. Need to expand the dataset significantly before generating curated chains. See "Data Strategy" section below.

### Launch Strategy: Curated First

Instead of real-time AI generation (risky quality, latency, cost), launch with pre-built chains:

1. **Launch (v1):** Curated chains (number TBD — depends on data expansion), browseable gallery + "Surprise me" random
2. **v2:** Add two-city input, AI generates on-demand, caches in `six_degrees_chains` table
3. **v3:** Open-ended with any city pair

Benefits: guaranteed quality, zero latency (< 50ms from SQLite), zero per-request cost, learn from user behavior before investing in real-time AI.

---

## UX Ideas (Steal These)

### Input (for v2)
- **"Surprise me" button** — picks two random cities, removes friction of having to think
- **Animated placeholder text** cycling through example pairs: "What connects Tokyo and Rome?"
- **Swap button** between two city inputs with 180-degree rotation animation
- **Label "Connect" not "Search"** — we're not a booking engine
- **Autocomplete against local destinations table** (3,380 entries, no external API needed)
- **Show country alongside city name** to disambiguate ("Paris, France" vs "Paris, Texas")

### Visualization
- **Vertical chain/stepper layout** — not a force-directed graph
- **Staggered chain reveal** — each stop animates in one at a time (Framer Motion `staggerChildren`)
- **SVG path drawing** for animated connecting lines between stops (stroke-dasharray technique)
- **Each node is a tour card** with photo, title, destination, and thematic connection description
- **Mobile-first vertical scrolling** — works naturally on phones

### Loading & Polish (for v2 on-demand)
- **Fun loading messages** while AI works: "Tracing the spice routes...", "Following the pasta trail...", "Asking a local..."
- **Animated dotted path** "drawing" between two pin icons during loading
- **Step-by-step reveal** — don't show the whole chain at once, reveal one link at a time

### Gallery (for v1 curated launch)
- Each chain is a card: "Tokyo to Rome" with a teaser like "Connected by: tea ceremonies, ancient temples, and pasta"
- Tap to see the full chain with animated reveal
- "Surprise me" picks a random chain
- Each chain has its own URL (`/six-degrees/tokyo-rome`) and OG image

---

## Technical Approach

### Chain Generation (Build-Time Script)

Two-step process:
1. **Claude generates the thematic chain** — given two cities and their available tours, find 3-6 intermediate cities with thematic links
2. **Match real tours from SQLite** — for each stop in the chain, pick the best matching tour

### Caching
- Store in existing `six_degrees_chains` table (already in schema)
- Normalize city pairs alphabetically: "Rome→Tokyo" and "Tokyo→Rome" hit same cache
- TTL: 7-30 days (thematic links don't go stale)

### Pre-computation
- Script generates chains for curated city pairs
- Review output manually for quality
- Only ship chains that are genuinely surprising and fun

### Cost
- Claude Sonnet 4.6: ~$0.02/chain
- Pre-computing 30 chains: ~$0.60
- On-demand (v2): cached after first generation

### Tech Stack (No New Dependencies for v1)
- Pure SVG + CSS for chain visualization (no graph library)
- Framer Motion for animations (add when building UI)
- Custom combobox for autocomplete (v2)
- SQLite `six_degrees_chains` for storage

---

## Prompt Engineering (Validated)

See `src/scripts/test-chain.ts` for the working prompt (v2).

### v1 prompt issues (fixed)
- Chains were sometimes 2-3 stops instead of 4-6 (Marrakech→Kyoto returned only 2 stops)
- Themes repeated within same chain (Barcelona→Sydney used "dark-tourism" twice)

### v2 prompt (current, working)
- Hardcoded "EXACTLY 5 stops" with explicit slot naming (City1 → City2 → City3 → City4 → City5)
- "HARD RULES" section with numbered constraints (5 stops, unique cities, unique themes, real tours only)
- Repeated the constraint in the user prompt for reinforcement
- Result: **8/8 test runs produce exactly 5 stops, unique themes, unique cities**

Key principles:
- Send Claude the actual tour titles + IDs from our DB (top 30 per city by rating)
- Send 20 random intermediate cities alongside start/end cities
- Ask for structured JSON output
- Each connection must use a different theme
- Connections should feel surprising ("oh, I see it!"), not obvious
- Exactly 5 stops (start + 3 intermediate + end)

---

## Data Strategy (In Discussion)

Three separate concerns that all affect launch quality:

### 1. Seed Dataset Size
Currently 53 destinations / ~9,800 tours. Viator has 3,380 destinations / 300K+ tours. Need to decide how many to index before building Six Degrees UI. More cities = more chain variety = better product. But also: more one-liners to generate, more data to maintain.

### 2. AI One-Liners
Every tour needs a one-liner for display. Currently backfilling ~9,800 at ~$0.03 total (Haiku 4.5). Any new tours from expanded indexing will also need one-liners.

### 3. Number of Curated Chains
Original estimate was 20-30. With more cities, could go much higher (50-100+). Each chain costs ~$0.02 to generate. Chains are bidirectional (Tokyo→Rome and Rome→Tokyo use same data, display reversed).

**Key concern:** If data quantity at launch feels thin, users bounce. The product needs to feel abundant and surprising — not like a demo with 20 pre-baked examples.

---

## Open Questions

- [ ] How many destinations to index? (100? 200? 500?)
- [ ] How many curated chains for launch?
- [ ] What does the OG image look like for a chain?
- [ ] Daily featured chain? Or static gallery?
- [x] ~~Should chains be directional or bidirectional?~~ → Bidirectional (store one direction, reverse for display)
- [x] ~~Do we need intermediate cities?~~ → Yes, validated. 5-stop chains across multiple cities are significantly better than 2-city chains.
- [x] ~~Prompt quality reliable?~~ → Yes, v2 prompt produces consistent 5-stop, unique-theme chains.

---

## Test Results

Test output saved in `data/chain-tests/`. All runs use v2 prompt (5 stops enforced).

### v2 Results (February 28, 2026)

| Pair | Time | Stops | Themes | Quality |
|------|------|-------|--------|---------|
| Tokyo → Rome | 11.5s | 5 | craftsmanship → nightlife → ancient history → sacred → photography | Great. Tokyo calligraphy → Singapore bike tour → Athens philosophy → Istanbul Hagia Sophia → Rome photoshoot. |
| Marrakech → Kyoto | 13.3s | 5 | craftsmanship → markets → ancient history → wine → music | Excellent. Rug weaving → Turkish carpets → Greek philosophy → Vienna wine → Kyoto shamisen. |
| Buenos Aires → Istanbul | 13.1s | 5 | art → craftsmanship → community → sacred → ancient history | Excellent. Best narrative arc. Retiro gallery → Spitalfields → Dharavi → Jerusalem quarters → Hagia Sophia. |
| Barcelona → Sydney | 12.3s | 5 | sacred → craftsmanship → cuisine → architecture → water | Great. Sagrada Familia → Fushimi Inari → Tokyo ramen → Marrakech medina → Sydney sailing. |
| LA → Phuket (random) | 12.9s | 5 | dark tourism → markets → music → meditation → sacred | Excellent. "From the dark to the divine." Manson tour → Jack the Ripper → Moroccan live show → Vienna music → Phuket temple. |
| Tokyo → Rome (v2 rerun) | 13.6s | 5 | wine → music → hiking → photography → ancient history | Good. Sake → makgeolli → Vienna concerts → Provence wine → Trevi photoshoot. Minor theme mislabel. |

### v1 Results (for comparison — before prompt fix)

| Pair | Stops | Issue |
|------|-------|-------|
| Marrakech → Kyoto | 2 | Too short, same theme repeated |
| Barcelona → Sydney | 3 | Too short, theme repeated |

### Observations
- ~14K input tokens / ~600 output tokens per chain
- Cost: ~$0.02/chain (Sonnet 4.6)
- Vienna and Istanbul appear frequently as intermediate hubs (rich thematic coverage)
- Connection writing quality is consistently warm, witty, and surprising
- Occasional theme mislabeling (tour tagged wrong theme) but connections themselves are solid
