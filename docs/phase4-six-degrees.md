# Phase 4: Six Degrees of Anywhere â€” Research & Design

---
**Last Updated**: March 1, 2026
**Status**: v1 UI spec finalized, building
---

## Concept

Type two cities. See a chain of real tours connecting them through surprising thematic links â€” shared activities, cultural connections, overlapping cuisines, historical threads. The name "TourGraph" finally earns itself.

---

## Research Findings

### Existing "Six Degrees" Products

| Product | How connections work | Visualization | Key lesson |
|---------|---------------------|---------------|------------|
| Six Degrees of Wikipedia | BFS on pre-built hyperlink graph | Simple text chain | Two-input autocomplete pattern works |
| Oracle of Bacon | BFS on actor-movie bipartite graph | Text chain | **95% cache hit rate** â€” aggressive caching is essential |
| Six Degrees of Spotify | Neo4j graph DB, collaboration edges | **Vertical chain** with Spotify embeds | Vertical chain is simple and effective |
| Cinema Chain Game | Known graph, user guesses links | Vertical sequence | Step-by-step reveal creates excitement |
| The Six Degrees (app) | Daily word connection puzzle | Sequential reveal | "Daily" framing + surprising connections = engagement |
| Pathica | Neo4j on 2.2B Instagram edges | Chain display | Graph DBs for pre-existing edges, not needed for AI-generated chains |

**Key insight:** All existing products traverse a *pre-existing graph*. TourGraph is different â€” our connections are thematic and creative, generated by AI. That's the unique angle.

### Our Data: Thematic Coverage

From analysis of 9,800+ tours across 43 destinations:

| Theme | Tour count | Best cities |
|-------|-----------|-------------|
| Water (boats/cruises/sailing) | 708 | Everywhere |
| Food (cooking/tasting/culinary) | 540 | Ho Chi Minh City (31), Seoul (25), Singapore (22), Lima (21), Athens (20) |
| Drinks (wine/beer/brewing) | 178 | Wide spread |
| Photography | 170 | Wide spread |
| Sunset/Sunrise | 162 | Bali, Cape Town, Cancun |
| Hiking/Trekking | 130 | Bali, Cusco, Cape Town |
| Dark tourism (ghost/haunted) | 113 | San Antonio (13), Maryland (11), Key West (11), London (7) |
| Sacred (temples/churches/mosques) | 98 | Istanbul, Kyoto, Bali, Rome |
| Markets (bazaar/souk) | 81 | Marrakech, Istanbul, Seoul, Bangkok |
| Street art/graffiti | 17 | Buenos Aires, Barcelona, Amsterdam |

**8 cities with all themes covered** (natural chain hubs): Rome, Prague, Cape Town, Barcelona, Amsterdam, Ontario, Vienna, Sydney.

### Data Gap (Critical Discovery)

We only indexed **53 of 3,380 Viator destinations** â€” 1.6% of available data. This was a dev seed, not a production dataset. Missing entirely: Chicago, Miami, Berlin, Osaka, Hanoi, Dublin, Florence, Santorini, and thousands more.

**Impact on Six Degrees:** More cities = more surprising chains = better product. Need to expand the dataset significantly before generating curated chains. See "Data Strategy" section below.

### Launch Strategy: Curated First

Instead of real-time AI generation (risky quality, latency, cost), launch with pre-built chains:

1. **Launch (v1):** Curated chains (number TBD â€” depends on data expansion), browseable gallery + "Surprise me" random
2. **v2:** Add two-city input, AI generates on-demand, caches in `six_degrees_chains` table
3. **v3:** Open-ended with any city pair

Benefits: guaranteed quality, zero latency (< 50ms from SQLite), zero per-request cost, learn from user behavior before investing in real-time AI.

---

## UX Ideas (Steal These)

### Input (for v2)
- **"Surprise me" button** â€” picks two random cities, removes friction of having to think
- **Animated placeholder text** cycling through example pairs: "What connects Tokyo and Rome?"
- **Swap button** between two city inputs with 180-degree rotation animation
- **Label "Connect" not "Search"** â€” we're not a booking engine
- **Autocomplete against local destinations table** (3,380 entries, no external API needed)
- **Show country alongside city name** to disambiguate ("Paris, France" vs "Paris, Texas")

### Visualization
- **Vertical chain/stepper layout** â€” not a force-directed graph
- **Staggered chain reveal** â€” each stop animates in one at a time (Framer Motion `staggerChildren`)
- **SVG path drawing** for animated connecting lines between stops (stroke-dasharray technique)
- **Each node is a tour card** with photo, title, destination, and thematic connection description
- **Mobile-first vertical scrolling** â€” works naturally on phones

### Loading & Polish (for v2 on-demand)
- **Fun loading messages** while AI works: "Tracing the spice routes...", "Following the pasta trail...", "Asking a local..."
- **Animated dotted path** "drawing" between two pin icons during loading
- **Step-by-step reveal** â€” don't show the whole chain at once, reveal one link at a time

### Gallery (for v1 curated launch)
- Each chain is a card: "Tokyo to Rome" with a teaser like "Connected by: tea ceremonies, ancient temples, and pasta"
- Tap to see the full chain with animated reveal
- "Surprise me" picks a random chain
- Each chain has its own URL (`/six-degrees/tokyo-rome`) and OG image

---

## v1 UI Spec (Final)

Two pages. Pure CSS, no new dependencies. Dark theme, mobile-first.

### Gallery Page (`/six-degrees`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            TourGraph              â”‚
â”‚                                   â”‚
â”‚     Six Degrees of Anywhere       â”‚
â”‚     "Every city is connected.     â”‚
â”‚      Find the surprising links."  â”‚
â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Tokyo â†’ Rome                â”‚  â”‚
â”‚  â”‚ "From sushi to pasta,       â”‚  â”‚
â”‚  â”‚  through ancient temples    â”‚  â”‚
â”‚  â”‚  and street art"            â”‚  â”‚
â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚ Connected by: craftsmanship â”‚  â”‚
â”‚  â”‚ Â· nightlife Â· ancient       â”‚  â”‚
â”‚  â”‚ history Â· sacred            â”‚  â”‚
â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚ 5 stops Â· 4 themes          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Buenos Aires â†’ Istanbul     â”‚  â”‚
â”‚  â”‚ ...                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚
â”‚       [ Surprise Me ]             â”‚
â”‚                                   â”‚
â”‚  roulette Â· right now Â· ...       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Each chain = a card showing city pair, summary quote, theme list, stop count
- Tapping a card â†’ detail page
- "Surprise Me" button picks a random chain (client-side redirect)
- Each chain has a unique URL: `/six-degrees/tokyo-rome`
- Data: query `six_degrees_chains` table, server component

### Detail Page (`/six-degrees/[slug]`)

Vertical timeline/stepper layout. Left-side line with circle nodes at each stop. Tour card at each node. Theme badge + connection text between stops.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            TourGraph              â”‚
â”‚                                   â”‚
â”‚      Tokyo â†’ Rome                 â”‚
â”‚      "From sushi to pasta..."     â”‚
â”‚                                   â”‚
â”‚   â—  1. Tokyo, Japan              â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â”‚ ðŸ–¼ [tour photo]        â”‚   â”‚
â”‚   â”‚  â”‚ "Calligraphy Workshop" â”‚   â”‚
â”‚   â”‚  â”‚ â˜… 4.9  $45  2 hrs     â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”‚                               â”‚
â”‚   â”‚  â”ˆ craftsmanship â”ˆ            â”‚
â”‚   â”‚  "From brush strokes in       â”‚
â”‚   â”‚   Tokyo to silver filigree    â”‚
â”‚   â”‚   in Singapore..."            â”‚
â”‚   â”‚                               â”‚
â”‚   â—  2. Singapore                 â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â”‚ ðŸ–¼ [tour photo]        â”‚   â”‚
â”‚   â”‚  â”‚ "Night Bike Tour"      â”‚   â”‚
â”‚   â”‚  â”‚ â˜… 4.8  $55  3 hrs     â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”‚                               â”‚
â”‚   â”‚  â”ˆ nightlife â”ˆ                â”‚
â”‚   â”‚  "Both cities come alive      â”‚
â”‚   â”‚   after dark..."              â”‚
â”‚   â”‚                               â”‚
â”‚   â—  3. Athens, Greece            â”‚
â”‚   â”‚  ...                          â”‚
â”‚   â”‚                               â”‚
â”‚   â—  4. Istanbul, Turkey          â”‚
â”‚   â”‚  ...                          â”‚
â”‚   â”‚                               â”‚
â”‚   â—  5. Rome, Italy               â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚      â”‚ ðŸ–¼ [tour photo]        â”‚   â”‚
â”‚      â”‚ "Sunset at Colosseum"  â”‚   â”‚
â”‚      â”‚ â˜… 5.0  $120  2 hrs    â”‚   â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚
â”‚   [ Share ]  [ Explore Another ]  â”‚
â”‚                                   â”‚
â”‚   roulette Â· right now Â· ...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Design Details

- **Vertical line**: `border-left: 2px solid` in `text-dim` color, offset from left edge
- **Circle nodes**: Pseudo-element circles at each stop, filled with accent color
- **Tour cards**: Reuse existing card styling â€” photo (aspect 3:2), title, stats row. Tappable to `/roulette/[id]` detail page.
- **Theme badge**: Small pill/tag between stops showing the theme (e.g., "craftsmanship"), styled like a category tag
- **Connection text**: The witty 1-2 sentence description below the theme badge. Italic, `text-muted`.
- **Last stop**: No connection text or line below it
- **Mobile**: Single column, full width. Line on left. Natural vertical scroll.
- **Desktop**: Max-width container (same `max-w-lg` as other pages), centered.

### Gallery Card Design

- Background: `bg-surface` (same as tour cards)
- City pair as heading: "Tokyo â†’ Rome" in bold
- Summary quote in italic below
- Theme list: "Connected by: craftsmanship, nightlife, ancient history, sacred" in `text-dim`
- Metadata: "5 stops" in small text
- Whole card is a link to the detail page

### OG Image (`/api/og/six-degrees/[slug]`)

- 1200x630, dark background
- City pair as large text: "Tokyo â†’ Rome"
- Summary quote below
- 5 small circles connected by a line (mini chain visualization)
- TourGraph branding

### What's NOT in v1

- No two-city input (v2)
- No staggered reveal animation (v2 â€” add Framer Motion later)
- No SVG path drawing animation (v2)
- No loading states (v1 is pre-computed, instant)
- No daily featured chain (decide later)

### Routes

| Route | Type | Purpose |
|-------|------|---------|
| `/six-degrees` | Gallery page (server component) | Browse all curated chains |
| `/six-degrees/[slug]` | Detail page (server component) | View full chain with timeline |
| `/api/og/six-degrees/[slug]` | OG image route | Social preview for shared chains |

### Data Flow

1. `six_degrees_chains` table has pre-computed chains (from `generate-chains.ts`)
2. Gallery page queries all chains, renders as cards
3. Detail page looks up chain by slug (`tokyo-rome`), renders timeline
4. Each tour in the chain is looked up from `tours` table for photo/stats
5. OG image generated on-demand from chain data

---

## Technical Approach

### Chain Generation (Build-Time Script)

Two-step process:
1. **Claude generates the thematic chain** â€” given two cities and their available tours, find 3-6 intermediate cities with thematic links
2. **Match real tours from SQLite** â€” for each stop in the chain, pick the best matching tour

### Caching
- Store in existing `six_degrees_chains` table (already in schema)
- Normalize city pairs alphabetically: "Romeâ†’Tokyo" and "Tokyoâ†’Rome" hit same cache
- TTL: 7-30 days (thematic links don't go stale)

### Pre-computation
- Script generates chains for curated city pairs
- Review output manually for quality
- Only ship chains that are genuinely surprising and fun

### Cost
- Claude Sonnet 4.6: ~$0.02/chain
- Pre-computing 30 chains: ~$0.60
- On-demand (v2): cached after first generation

### Tech Stack (No New Dependencies for v1)
- Pure SVG + CSS for chain visualization (no graph library)
- Framer Motion for animations (add when building UI)
- Custom combobox for autocomplete (v2)
- SQLite `six_degrees_chains` for storage

---

## Prompt Engineering (Validated)

See `src/scripts/test-chain.ts` for the working prompt (v2).

### v1 prompt issues (fixed)
- Chains were sometimes 2-3 stops instead of 4-6 (Marrakechâ†’Kyoto returned only 2 stops)
- Themes repeated within same chain (Barcelonaâ†’Sydney used "dark-tourism" twice)

### v2 prompt (current, working)
- Hardcoded "EXACTLY 5 stops" with explicit slot naming (City1 â†’ City2 â†’ City3 â†’ City4 â†’ City5)
- "HARD RULES" section with numbered constraints (5 stops, unique cities, unique themes, real tours only)
- Repeated the constraint in the user prompt for reinforcement
- Result: **8/8 test runs produce exactly 5 stops, unique themes, unique cities**

Key principles:
- Send Claude the actual tour titles + IDs from our DB (top 30 per city by rating)
- Send 20 random intermediate cities alongside start/end cities
- Ask for structured JSON output
- Each connection must use a different theme
- Connections should feel surprising ("oh, I see it!"), not obvious
- Exactly 5 stops (start + 3 intermediate + end)

---

## Data Strategy (In Discussion)

Three separate concerns that all affect launch quality:

### 1. Seed Dataset Size
Currently 53 destinations / ~9,800 tours. Viator has 3,380 destinations / 300K+ tours. Need to decide how many to index before building Six Degrees UI. More cities = more chain variety = better product. But also: more one-liners to generate, more data to maintain.

### 2. AI One-Liners
Every tour needs a one-liner for display. Currently backfilling ~9,800 at ~$0.03 total (Haiku 4.5). Any new tours from expanded indexing will also need one-liners.

### 3. Number of Curated Chains
Original estimate was 20-30. With more cities, could go much higher (50-100+). Each chain costs ~$0.02 to generate. Chains are bidirectional (Tokyoâ†’Rome and Romeâ†’Tokyo use same data, display reversed).

**Key concern:** If data quantity at launch feels thin, users bounce. The product needs to feel abundant and surprising â€” not like a demo with 20 pre-baked examples.

---

## Open Questions

- [x] ~~How many destinations to index?~~ â†’ All 2,712 leaf destinations (indexer running now)
- [ ] How many curated chains for launch? (decide after data expansion)
- [x] ~~What does the OG image look like for a chain?~~ â†’ Dark bg, city pair text, summary, mini chain dots, branding
- [ ] Daily featured chain? Or static gallery? (decide later)
- [x] ~~Should chains be directional or bidirectional?~~ â†’ Bidirectional (store one direction, reverse for display)
- [x] ~~Do we need intermediate cities?~~ â†’ Yes, validated. 5-stop chains across multiple cities are significantly better than 2-city chains.
- [x] ~~Prompt quality reliable?~~ â†’ Yes, v2 prompt produces consistent 5-stop, unique-theme chains.

---

## Test Results

Test output saved in `data/chain-tests/`. All runs use v2 prompt (5 stops enforced).

### v2 Results (February 28, 2026)

| Pair | Time | Stops | Themes | Quality |
|------|------|-------|--------|---------|
| Tokyo â†’ Rome | 11.5s | 5 | craftsmanship â†’ nightlife â†’ ancient history â†’ sacred â†’ photography | Great. Tokyo calligraphy â†’ Singapore bike tour â†’ Athens philosophy â†’ Istanbul Hagia Sophia â†’ Rome photoshoot. |
| Marrakech â†’ Kyoto | 13.3s | 5 | craftsmanship â†’ markets â†’ ancient history â†’ wine â†’ music | Excellent. Rug weaving â†’ Turkish carpets â†’ Greek philosophy â†’ Vienna wine â†’ Kyoto shamisen. |
| Buenos Aires â†’ Istanbul | 13.1s | 5 | art â†’ craftsmanship â†’ community â†’ sacred â†’ ancient history | Excellent. Best narrative arc. Retiro gallery â†’ Spitalfields â†’ Dharavi â†’ Jerusalem quarters â†’ Hagia Sophia. |
| Barcelona â†’ Sydney | 12.3s | 5 | sacred â†’ craftsmanship â†’ cuisine â†’ architecture â†’ water | Great. Sagrada Familia â†’ Fushimi Inari â†’ Tokyo ramen â†’ Marrakech medina â†’ Sydney sailing. |
| LA â†’ Phuket (random) | 12.9s | 5 | dark tourism â†’ markets â†’ music â†’ meditation â†’ sacred | Excellent. "From the dark to the divine." Manson tour â†’ Jack the Ripper â†’ Moroccan live show â†’ Vienna music â†’ Phuket temple. |
| Tokyo â†’ Rome (v2 rerun) | 13.6s | 5 | wine â†’ music â†’ hiking â†’ photography â†’ ancient history | Good. Sake â†’ makgeolli â†’ Vienna concerts â†’ Provence wine â†’ Trevi photoshoot. Minor theme mislabel. |

### v1 Results (for comparison â€” before prompt fix)

| Pair | Stops | Issue |
|------|-------|-------|
| Marrakech â†’ Kyoto | 2 | Too short, same theme repeated |
| Barcelona â†’ Sydney | 3 | Too short, theme repeated |

### Observations
- ~14K input tokens / ~600 output tokens per chain
- Cost: ~$0.02/chain (Sonnet 4.6)
- Vienna and Istanbul appear frequently as intermediate hubs (rich thematic coverage)
- Connection writing quality is consistently warm, witty, and surprising
- Occasional theme mislabeling (tour tagged wrong theme) but connections themselves are solid
